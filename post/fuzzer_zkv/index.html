<!DOCTYPE html>
<html lang="zh"><head>
    <meta charset="UTF-8">
    <title>やれやれ DA✰ZE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="from 0 to 1" />
    <meta property="og:title" content="ZKV的Fuzzing早教" />
    <meta property="og:description" content="from 0 to 1" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://dev2ero.github.io/post/fuzzer_zkv/" />
    <meta itemprop="name" content="ZKV的Fuzzing早教">
    <meta itemprop="description" content="from 0 to 1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
    
    <link rel="stylesheet" href="https://dev2ero.github.io/scss/style.min.5cc161ce25a37cfa33a6a8df8803b39268d6c4b6a5be5bb9d1f929e7f113117f.css" >
</head>
<body>
    <header>
    <div class="header header-frame">
        <div>
          
            <h1 class="header__title">ZKV的Fuzzing早教</h1>
          
            
                <div class="header__description">from 0 to 1</div>
            
        </div>
        <nav class="header-nav">
            <ul class="header-nav-list header-nav-list--menu">
                
                
                    
                        <li class="header-nav-list__item">
                            <a class="header-nav-list__link" href="/main/about/">
                                
                                <span>About</span>
                            </a>
                        </li>
                    
                
                    
                        <li class="header-nav-list__item">
                            <a class="header-nav-list__link" href="/main/board/">
                                
                                <span>Board</span>
                            </a>
                        </li>
                    
                
                    
                        <li class="header-nav-list__item">
                            <a class="header-nav-list__link" href="/main/flink/">
                                
                                <span>Flink</span>
                            </a>
                        </li>
                    
                
                    
                        <li class="header-nav-list__item">
                            <a class="header-nav-list__link" href="/main/utils/">
                                
                                <span>Utils</span>
                            </a>
                        </li>
                    
                
                    
                        <li class="header-nav-list__item">
                            <a class="header-nav-list__link" href="/main/love/">
                                
                                <span>Love</span>
                            </a>
                        </li>
                    
                
            </ul>
            <button class="header-nav-list__nav-btn">⨈</button>
        </nav>
        <button class="mb-header__menu-btn">
            <span class="mb-header__menu-btn-line"></span>
            <span class="mb-header__menu-btn-line"></span>
            <span class="mb-header__menu-btn-line"></span>
        </button>
    </div>
    <nav id="mobile-header-nav" class="mb-header-nav">
  
  
  <button class="mb-header-nav__close-btn flex-center">
    <svg
            class="mb-header-nav__svg-icon"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            width="32"
            height="32"
            >
            <path
                d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                />
            <path d="M0 0h24v24H0z" fill="none" />
        </svg>
    </button>
    
    <div class="mb-header-nav__wrapper">
        <div class="mb-header-nav__container">
            <svg
                width="240"
                height="72"
                viewBox="0 0 240 72"
                class="mb-header-nav__title"
                >
                <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle">
                Tags
                </text>
            </svg>
            <ul class="mb-header-nav-list">
                
                    
                        
                          <li class="mb-header-nav-list__item ">
                        <a class="mb-header-nav-list__link" href="https://dev2ero.github.io/tags/fuzzing/"
                                                            >fuzzing</a
                                                        >
                    </li>
                        
                    
                
            </ul>
        </div>
        <div class="mb-header-nav__container">
            <svg
                width="240"
                height="72"
                viewBox="0 0 240 72"
                class="mb-header-nav__title"
                >
                <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle">
                Menu
                </text>
            </svg>
            <ul class="mb-header-nav-list">
                
                
                    
                      <li class="mb-header-nav-list__item ">
                            <a class="mb-header-nav-list__link" href="/main/about/">
                                About
                            </a>
                        </li>
                    
                
                    
                      <li class="mb-header-nav-list__item ">
                            <a class="mb-header-nav-list__link" href="/main/board/">
                                Board
                            </a>
                        </li>
                    
                
                    
                      <li class="mb-header-nav-list__item ">
                            <a class="mb-header-nav-list__link" href="/main/flink/">
                                Flink
                            </a>
                        </li>
                    
                
                    
                      <li class="mb-header-nav-list__item ">
                            <a class="mb-header-nav-list__link" href="/main/utils/">
                                Utils
                            </a>
                        </li>
                    
                
                    
                      <li class="mb-header-nav-list__item ">
                            <a class="mb-header-nav-list__link" href="/main/love/">
                                Love
                            </a>
                        </li>
                    
                
            </ul>
        </div>
    </div>
</nav>

</header>



    <div id="content">
<article class="post">
  
    <div class="post-content"><h2 id="x00-早教教程">\x00 早教教程</h2>
<h3 id="教程">教程</h3>
<p><a href="https://github.com/google/fuzzing">谷歌的Fuzzing教程</a></p>
<p><a href="https://www.fuzzingbook.org/">Fuzzingbook</a></p>
<h3 id="课程">课程</h3>
<p><a href="https://pascal-group.bitbucket.io/teaching.html">南京大学：软件分析</a></p>
<p><a href="https://www.bilibili.com/video/BV1b7411K7P4/?spm_id_from=333.788.videocard.1">南京大学：软件分析课程视频</a></p>
<h3 id="博文">博文</h3>
<p><a href="https://blog.flanker017.me/fuzzing%e6%88%98%e4%ba%89-%e4%bb%8e%e5%88%80%e5%89%91%e5%bc%93%e6%96%a7%e5%88%b0%e6%98%9f%e7%90%83%e5%a4%a7%e6%88%98/">Fuzzing战争: 从刀剑弓斧到星球大战</a></p>
<p><a href="https://blog.flanker017.me/fuzzing%e6%88%98%e4%ba%89%e7%b3%bb%e5%88%97%e4%b9%8b%e4%ba%8c%ef%bc%9a%e4%b8%8d%e7%95%8f%e6%b5%ae%e4%ba%91%e9%81%ae%e6%9c%9b%e7%9c%bc/">Fuzzing战争系列之二：不畏浮云遮望眼</a></p>
<h3 id="练兵场">练兵场</h3>
<p><a href="https://github.com/antonio-morales/Fuzzing101">Fuzzing101</a></p>
<h3 id="兵器">兵器</h3>
<p><a href="https://github.com/google/AFL">AFL</a></p>
<p><a href="https://github.com/AFLplusplus/AFLplusplus">AFLplusplus</a></p>
<h2 id="x01-学步车">\x01 学步车</h2>
<h3 id="最简单的-fuzzing-demo">最简单的 fuzzing demo</h3>
<p>使用AFL，故先安装：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>git clone https://github.com/google/AFL.git
</span></span><span style="display:flex;"><span><span style="color:#0086b3">cd</span> AFL
</span></span><span style="display:flex;"><span>make -j<span style="color:#d14">`</span>nproc<span style="color:#d14">`</span>
</span></span><span style="display:flex;"><span>sudo make install
</span></span></code></pre></div><p>接着准备被测程序源码：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;stdio.h&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;string.h&gt; </span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;signal.h&gt; </span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">vuln</span>(<span style="color:#458;font-weight:bold">char</span> <span style="color:#000;font-weight:bold">*</span>str) {
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> len <span style="color:#000;font-weight:bold">=</span> strlen(str);
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span>(str[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;A&#39;</span> <span style="color:#000;font-weight:bold">&amp;&amp;</span> len <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">66</span>)
</span></span><span style="display:flex;"><span>        raise(SIGSEGV);
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span>(str[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;F&#39;</span> <span style="color:#000;font-weight:bold">&amp;&amp;</span> len <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">6</span>)
</span></span><span style="display:flex;"><span>        raise(SIGSEGV);
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>        puts(<span style="color:#d14">&#34;</span><span style="color:#d14">\n</span><span style="color:#d14">nothing happened&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">main</span>(<span style="color:#458;font-weight:bold">int</span> argc, <span style="color:#458;font-weight:bold">char</span> <span style="color:#000;font-weight:bold">*</span>argv[]) {
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">char</span> buf[<span style="color:#099">100</span>]<span style="color:#000;font-weight:bold">=</span>{<span style="color:#099">0</span>};
</span></span><span style="display:flex;"><span>    gets(buf);
</span></span><span style="display:flex;"><span>    printf(buf);
</span></span><span style="display:flex;"><span>    vuln(buf);
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>使用afl-gcc插装编译：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>afl-gcc vulner.c -o vulner
</span></span></code></pre></div><p>准备fuzzing输入与输出的文件夹：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mkdir fuzz_in fuzz_out
</span></span></code></pre></div><p>创建两个样例输入：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#0086b3">echo</span> -n AAAA &gt; fuzz_in/input_case_1
</span></span><span style="display:flex;"><span><span style="color:#0086b3">echo</span> -e -n <span style="color:#d14">&#34;\x01\x02\x03\x04&#34;</span> &gt; fuzz_in/input_case_2
</span></span></code></pre></div><p>启动fuzzing：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>afl-fuzz -i fuzz_in -o fuzz_out ./vulner
</span></span></code></pre></div><p>Ctrl+C停止后，由fuzzing_out中拿到fuzzing结果。用其中的一个crash输入测试下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>➜ ./vulner &lt; fuzz_out/crashes/id:000000,sig:06,src:000000,op:havoc,rep:32
</span></span><span style="display:flex;"><span><span style="color:#099">6666</span>
</span></span><span style="display:flex;"><span>nothing happened
</span></span><span style="display:flex;"><span>*** stack smashing detected ***: terminated
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span>    <span style="color:#099">1541204</span> abort      ./vulner &lt; fuzz_out/crashes/id:000000,sig:06,src:000000,op:havoc,rep:32
</span></span></code></pre></div><p>可以看到发生了栈溢出。</p>
<h3 id="为学步车装上名为sanitizers的轮子">为学步车装上名为sanitizers的轮子</h3>
<p>借助于<a href="https://github.com/google/sanitizers">sanitizers</a>获得更多崩溃的详细信息：</p>
<p>开启<a href="https://github.com/google/fuzzing/blob/master/docs/ASan">AddressSanitizer</a>重新编译程序：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span> afl-clang -fsanitize<span style="color:#000;font-weight:bold">=</span>address vulner.c -o vulner
</span></span></code></pre></div><p>使用上一部分相同的crash输入用例，来测试打开了AddressSanitizer的程序：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>➜ ./vulner &lt; fuzz_out/crashes/id:000000,sig:06,src:000000,op:havoc,rep:32
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">=================================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">==</span><span style="color:#008080">1541245</span><span style="color:#000;font-weight:bold">==</span>ERROR: AddressSanitizer: stack-buffer-overflow on address 0x7ffe9090e564 at pc 0x0000004393cb bp 0x7ffe9090e3a0 sp 0x7ffe9090db28
</span></span><span style="display:flex;"><span>READ of size <span style="color:#099">116</span> at 0x7ffe9090e564 thread T0
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#0 0x4393ca in printf_common(void*, char const*, __va_list_tag*) (/f/lab/fuzzing_baby/vulner+0x4393ca)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#1 0x43af1e in printf (/f/lab/fuzzing_baby/vulner+0x43af1e)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#2 0x4c3418 in main /root/lab/fuzzing_baby/vulner.c:17:5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#3 0x7f09a7252082 in __libc_start_main /build/glibc-SzIz7B/glibc-2.31/csu/../csu/libc-start.c:308:16</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#4 0x41b33d in _start (/f/lab/fuzzing_baby/vulner+0x41b33d)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Address 0x7ffe9090e564 is located in stack of thread T0 at offset <span style="color:#099">132</span> in frame
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#0 0x4c32cf in main /root/lab/fuzzing_baby/vulner.c:14</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  This frame has <span style="color:#099">1</span> object<span style="color:#000;font-weight:bold">(</span>s<span style="color:#000;font-weight:bold">)</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">[</span>32, 132<span style="color:#000;font-weight:bold">)</span> <span style="color:#d14">&#39;buf&#39;</span> <span style="color:#000;font-weight:bold">(</span>line 15<span style="color:#000;font-weight:bold">)</span> &lt;<span style="color:#000;font-weight:bold">==</span> Memory access at offset <span style="color:#099">132</span> overflows this variable
</span></span><span style="display:flex;"><span>HINT: this may be a <span style="color:#0086b3">false</span> positive <span style="color:#000;font-weight:bold">if</span> your program uses some custom stack unwind mechanism, swapcontext or vfork
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">(</span>longjmp and C++ exceptions *are* supported<span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>SUMMARY: AddressSanitizer: stack-buffer-overflow <span style="color:#000;font-weight:bold">(</span>/f/lab/fuzzing_baby/vulner+0x4393ca<span style="color:#000;font-weight:bold">)</span> in printf_common<span style="color:#000;font-weight:bold">(</span>void*, char const*, __va_list_tag*<span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>Shadow bytes around the buggy address:
</span></span><span style="display:flex;"><span>  0x100052119c50: <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span>
</span></span><span style="display:flex;"><span>  0x100052119c60: <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span>
</span></span><span style="display:flex;"><span>  0x100052119c70: <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span>
</span></span><span style="display:flex;"><span>  0x100052119c80: <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span>
</span></span><span style="display:flex;"><span>  0x100052119c90: <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> f1 f1 f1 <span style="color:#008080">f1</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">=</span>&gt;0x100052119ca0: <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> 00<span style="color:#000;font-weight:bold">[</span>04<span style="color:#000;font-weight:bold">]</span>f3 f3 f3
</span></span><span style="display:flex;"><span>  0x100052119cb0: f3 f3 f3 f3 <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span>
</span></span><span style="display:flex;"><span>  0x100052119cc0: <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span>
</span></span><span style="display:flex;"><span>  0x100052119cd0: <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span>
</span></span><span style="display:flex;"><span>  0x100052119ce0: <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span>
</span></span><span style="display:flex;"><span>  0x100052119cf0: <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span> <span style="color:#099">00</span>
</span></span><span style="display:flex;"><span>Shadow byte legend <span style="color:#000;font-weight:bold">(</span>one shadow byte represents <span style="color:#099">8</span> application bytes<span style="color:#000;font-weight:bold">)</span>:
</span></span><span style="display:flex;"><span>  Addressable:           <span style="color:#099">00</span>
</span></span><span style="display:flex;"><span>  Partially addressable: <span style="color:#099">01</span> <span style="color:#099">02</span> <span style="color:#099">03</span> <span style="color:#099">04</span> <span style="color:#099">05</span> <span style="color:#099">06</span> <span style="color:#099">07</span>
</span></span><span style="display:flex;"><span>  Heap left redzone:       fa
</span></span><span style="display:flex;"><span>  Freed heap region:       fd
</span></span><span style="display:flex;"><span>  Stack left redzone:      f1
</span></span><span style="display:flex;"><span>  Stack mid redzone:       f2
</span></span><span style="display:flex;"><span>  Stack right redzone:     f3
</span></span><span style="display:flex;"><span>  Stack after <span style="color:#000;font-weight:bold">return</span>:      f5
</span></span><span style="display:flex;"><span>  Stack use after scope:   f8
</span></span><span style="display:flex;"><span>  Global redzone:          f9
</span></span><span style="display:flex;"><span>  Global init order:       f6
</span></span><span style="display:flex;"><span>  Poisoned by user:        f7
</span></span><span style="display:flex;"><span>  Container overflow:      <span style="color:#0086b3">fc</span>
</span></span><span style="display:flex;"><span>  Array cookie:            ac
</span></span><span style="display:flex;"><span>  Intra object redzone:    bb
</span></span><span style="display:flex;"><span>  ASan internal:           fe
</span></span><span style="display:flex;"><span>  Left alloca redzone:     ca
</span></span><span style="display:flex;"><span>  Right alloca redzone:    cb
</span></span><span style="display:flex;"><span>  Shadow gap:              <span style="color:#008080">cc</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">==</span><span style="color:#008080">1541245</span><span style="color:#000;font-weight:bold">==</span>ABORTING
</span></span></code></pre></div><p>由此得到了crash的详细信息输出。</p>
<h3 id="黑盒测试qemu-mode拆走源码の轮儿">黑盒测试QEMU mode——拆走源码の轮儿</h3>
<p>AFL的QEMU mode不会默认安装，而是需要我们手动安装：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sudo apt install libtool libtool-bin libcapstone-dev
</span></span><span style="display:flex;"><span><span style="color:#0086b3">cd</span> AFL/qemu_mode
</span></span><span style="display:flex;"><span>./build_qemu_support.sh
</span></span><span style="display:flex;"><span><span style="color:#0086b3">cd</span> ..
</span></span><span style="display:flex;"><span>sudo make install 
</span></span></code></pre></div><p>如果遇到编译错误，可以使用这份fork：https://github.com/blurbdust/AFL.git</p>
<p>不插桩重新编译程序：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>gcc vulner.c -o vulner
</span></span></code></pre></div><p>开始QEMU mode黑盒fuzzing</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>afl-fuzz -Q -i fuzz_in -o fuzz_out ./vulner
</span></span></code></pre></div><h3 id="afl并发学步车的四缸引擎">AFL并发——学步车的四缸引擎</h3>
<p>通过-M指定master fuzzer进程，-S指定一系列slave fuzzer进程即可。四核机器就：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>afl-fuzz -i fuzz_in -o fuzz_out -M fuzzer1 ./vulner
</span></span><span style="display:flex;"><span>afl-fuzz -i fuzz_in -o fuzz_out -S fuzzer2 ./vulner
</span></span><span style="display:flex;"><span>afl-fuzz -i fuzz_in -o fuzz_out -S fuzzer3 ./vulner
</span></span><span style="display:flex;"><span>afl-fuzz -i fuzz_in -o fuzz_out -S fuzzer4 ./vulner
</span></span></code></pre></div></div>
  
</article>
<button class="floating-button">
    <a class="floating-button__link" href="https://dev2ero.github.io/">
        <span style="font-size: large;">⪡</span>
    </a>
</button>


    </div>
    
    <footer class="post-footer">
    <div class="footer">
        
            <div>© 2022, Zikey Vi</div>
        
        <div class="footer__socials">


<a
  href="mailto:dev2ero@foxmail.com"
  target="_blank"
  class="social-link"
  rel="noopener"
>
  <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Gmail</title><path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636 0 0 1 0 19.366V5.457c0-2.023 2.309-3.178 3.927-1.964L5.455 4.64 12 9.548l6.545-4.91 1.528-1.145C21.69 2.28 24 3.434 24 5.457z"/></svg>
</a>&nbsp;&nbsp;



<a
  href="https://github.com/dev2ero"
  target="_blank"
  class="social-link"
  rel="noopener"
>
  <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
</a>&nbsp;&nbsp;



<a
  href="https://twitter.com/dev2ero"
  target="_blank"
  class="social-link"
  rel="noopener"
>
  <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>
</a>&nbsp;&nbsp;



<a
  href="https://space.bilibili.com/210892014"
  target="_blank"
  class="social-link"
  rel="noopener"
>
  <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Bilibili</title><path d="M17.813 4.653h.854c1.51.054 2.769.578 3.773 1.574 1.004.995 1.524 2.249 1.56 3.76v7.36c-.036 1.51-.556 2.769-1.56 3.773s-2.262 1.524-3.773 1.56H5.333c-1.51-.036-2.769-.556-3.773-1.56S.036 18.858 0 17.347v-7.36c.036-1.511.556-2.765 1.56-3.76 1.004-.996 2.262-1.52 3.773-1.574h.774l-1.174-1.12a1.234 1.234 0 0 1-.373-.906c0-.356.124-.658.373-.907l.027-.027c.267-.249.573-.373.92-.373.347 0 .653.124.92.373L9.653 4.44c.071.071.134.142.187.213h4.267a.836.836 0 0 1 .16-.213l2.853-2.747c.267-.249.573-.373.92-.373.347 0 .662.151.929.4.267.249.391.551.391.907 0 .355-.124.657-.373.906zM5.333 7.24c-.746.018-1.373.276-1.88.773-.506.498-.769 1.13-.786 1.894v7.52c.017.764.28 1.395.786 1.893.507.498 1.134.756 1.88.773h13.334c.746-.017 1.373-.275 1.88-.773.506-.498.769-1.129.786-1.893v-7.52c-.017-.765-.28-1.396-.786-1.894-.507-.497-1.134-.755-1.88-.773zM8 11.107c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c.017-.391.15-.711.4-.96.249-.249.56-.373.933-.373Z"/></svg>
</a>&nbsp;&nbsp;



<a
  href="https://www.zhihu.com/people/izay01"
  target="_blank"
  class="social-link"
  rel="noopener"
>
  <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Zhihu</title><path d="M5.721 0C2.251 0 0 2.25 0 5.719V18.28C0 21.751 2.252 24 5.721 24h12.56C21.751 24 24 21.75 24 18.281V5.72C24 2.249 21.75 0 18.281 0zm1.964 4.078c-.271.73-.5 1.434-.68 2.11h4.587c.545-.006.445 1.168.445 1.171H9.384a58.104 58.104 0 01-.112 3.797h2.712c.388.023.393 1.251.393 1.266H9.183a9.223 9.223 0 01-.408 2.102l.757-.604c.452.456 1.512 1.712 1.906 2.177.473.681.063 2.081.063 2.081l-2.794-3.382c-.653 2.518-1.845 3.607-1.845 3.607-.523.468-1.58.82-2.64.516 2.218-1.73 3.44-3.917 3.667-6.497H4.491c0-.015.197-1.243.806-1.266h2.71c.024-.32.086-3.254.086-3.797H6.598c-.136.406-.158.447-.268.753-.594 1.095-1.603 1.122-1.907 1.155.906-1.821 1.416-3.6 1.591-4.064.425-1.124 1.671-1.125 1.671-1.125zM13.078 6h6.377v11.33h-2.573l-2.184 1.373-.401-1.373h-1.219zm1.313 1.219v8.86h.623l.263.937 1.455-.938h1.456v-8.86z"/></svg>
</a>&nbsp;&nbsp;



<a
  href="/main/love/"
  target="_blank"
  class="social-link"
  rel="noopener"
>
  <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Love</title><path d="M12 6.306L7.796 2.102 0 9.898l12 12 12-12-7.796-7.796zm0 12L3.592 9.898l4.204-4.204L12 9.898l4.184-4.184 4.204 4.204"/></svg>
</a>
</div>
    </div>
</footer>


    
    
      
<script src="https://dev2ero.github.io/js/script.js"></script>

    
  </body>
</html>
