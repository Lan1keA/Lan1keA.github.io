<header>
    <title>XV6-RISCV</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="/lib/page.css">
    <style> html * { color: #f2f2f2 !important; font-family: Terminus !important; } </style>
</header>

<body>
    <h1>XV6的ELF</h1>
<pre>
作为又一个类UNIX系统，XV6不出意外的将它的可执行文件格式定为了ELF，且是Linux下ELF结构的简化版本。
ELF的结构定义在了/kernel/elf.h中：
首先是ELF文件头的结构定义，以struct elfhdr呈现：

    // File header
    struct elfhdr {
        uint magic;         // 魔数 ELF_MAGIC，定义为：#define ELF_MAGIC 0x464C457FU  // "\x7FELF" in little endian
        uchar elf[12];      // ？？
        ushort type;        // ELF文件类型，如Relocatable file
        ushort machine;     // 平台类型，如RISC-V
        uint version;       // ELF版本号，一般为常数1
        uint64 entry;       // 程序入口地址（虚拟地址）
        uint64 phoff;       // program header offset，program header的起始地址
        uint64 shoff;       // section header offset，section header的起始地址
        uint flags;         // ？？
        ushort ehsize;      // elf header size
        ushort phentsize;   // program header ？？ ？？ size
        ushort phnum;       // number of program header
        ushort shentsize;   // section header ？？ ？？ size
        ushort shnum;       // number of section header
        ushort shstrndx;    // section header string table index， 段字符串表所在的段在段表中的下标
    };

<pre style="float: right; margin-right: 32px;">
Program Headers:
Type           Offset             VirtAddr           PhysAddr
                FileSiz            MemSiz              Flags  Align
PHDR            0x0000000000000040 0x0000000000000040 0x0000000000000040
                0x00000000000002d8 0x00000000000002d8  R      0x8
INTERP          0x0000000000000318 0x0000000000000318 0x0000000000000318
                0x000000000000001c 0x000000000000001c  R      0x1
    [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2]
LOAD            0x0000000000000000 0x0000000000000000 0x0000000000000000
                0x0000000000000a48 0x0000000000000a48  R      0x1000
LOAD            0x0000000000001000 0x0000000000001000 0x0000000000001000
                0x0000000000001065 0x0000000000001065  R E    0x1000
LOAD            0x0000000000003000 0x0000000000003000 0x0000000000003000
                0x0000000000000aa1 0x0000000000000aa1  R      0x1000
LOAD            0x0000000000003d38 0x0000000000004d38 0x0000000000004d38
                0x00000000000002e0 0x0000000000000420  RW     0x1000
DYNAMIC         0x0000000000003d50 0x0000000000004d50 0x0000000000004d50
                0x0000000000000210 0x0000000000000210  RW     0x8
NOTE            0x0000000000000338 0x0000000000000338 0x0000000000000338
                0x0000000000000020 0x0000000000000020  R      0x8
NOTE            0x0000000000000358 0x0000000000000358 0x0000000000000358
                0x0000000000000044 0x0000000000000044  R      0x4
GNU_PROPERTY    0x0000000000000338 0x0000000000000338 0x0000000000000338
                0x0000000000000020 0x0000000000000020  R      0x8
GNU_EH_FRAME    0x0000000000003044 0x0000000000003044 0x0000000000003044
                0x00000000000001fc 0x00000000000001fc  R      0x4
GNU_STACK       0x0000000000000000 0x0000000000000000 0x0000000000000000
                0x0000000000000000 0x0000000000000000  RW     0x10
GNU_RELRO       0x0000000000003d38 0x0000000000004d38 0x0000000000004d38
                0x00000000000002c8 0x00000000000002c8  R      0x1
</pre>

节头表以struct proghdr呈现：

    // Program section header
    struct proghdr {
        uint32 type;
        uint32 flags;
        uint64 off;
        uint64 vaddr;
        uint64 paddr;
        uint64 filesz;
        uint64 memsz;
        uint64 align;
    };

可以与右方的readelf的结果对照下 --->
可以发现XV6里不需要ld去装载ELF，这里并没有INTERP项
Program header is used when loading the ELF file
</pre>

</body>