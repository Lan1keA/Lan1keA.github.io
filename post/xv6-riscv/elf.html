<header>
    <title>XV6-RISCV</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="/lib/page.css">
    <style> html * { color: #f2f2f2 !important; font-family: Terminus !important; } </style>
</header>

<body>
    <h1>XV6的ELF</h1>
<pre>
作为又一个类UNIX系统，XV6不出意外的将它的可执行文件格式定为了ELF，且是Linux下ELF结构的简化版本。
ELF的结构定义在了/kernel/elf.h中：
首先是ELF文件头的结构定义，以struct elfhdr呈现：

    // File header
    struct elfhdr {
        uint magic;         // 魔数 ELF_MAGIC，定义为：#define ELF_MAGIC 0x464C457FU  // "\x7FELF" in little endian
        uchar elf[12];      // ？？
        ushort type;        // ELF文件类型，如Relocatable file
        ushort machine;     // 平台类型，如RISC-V
        uint version;       // ELF版本号，一般为常数1
        uint64 entry;       // 程序入口地址（虚拟地址）
        uint64 phoff;       // program header offset，program header的起始地址
        uint64 shoff;       // section header offset，section header的起始地址
        uint flags;         // ？？
        ushort ehsize;      // elf header size
        ushort phentsize;   // program header ？？ ？？ size
        ushort phnum;       // number of program header
        ushort shentsize;   // section header ？？ ？？ size
        ushort shnum;       // number of section header
        ushort shstrndx;    // section header string table index， 段字符串表所在的段在段表中的下标
    };

节头表以struct proghdr呈现：

    // Program section header
    struct proghdr {
        uint32 type;
        uint32 flags;
        uint64 off;
        uint64 vaddr;
        uint64 paddr;
        uint64 filesz;
        uint64 memsz;
        uint64 align;
    };
</pre>

</body>